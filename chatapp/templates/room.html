<!DOCTYPE html>
<html>
{% load static %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink">
    <title>GNU LOST</title>

    <!-- BOOTSTRAP LINK -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css"/>


    <!-- GOOGLE FONT LINK -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">

    <!--     GOOGLE MATERIAL ICONS     -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons"
  rel="stylesheet">

    <!--  DEFAULT CSS LINK  -->
    <link rel="stylesheet" type="text/css" href="{% static 'base.css' %}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var room_id = '{{ room_id }}';
        var chatSocket = new WebSocket((window.location.protocol === 'https:' ? 'wss://' : 'ws://') + window.location.host + '/ws/chat/' + room_id + '/');

        chatSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            var sender = data['sender'];

            // Display the message
            $('#chat-log').append('<div><strong>' + sender + '</strong>: ' + message + '</div>');
        };

        $(document).ready(function() {
            $('#chat-message-input').on('keypress', function(event) {
                if (event.keyCode === 13) {  // Enter key
                    event.preventDefault();
                    var messageInputDom = $('#chat-message-input');
                    var message = messageInputDom.val();

                    // Send the message
                    chatSocket.send(JSON.stringify({
                        'room_id': room_id,
                        'message': message
                    }));

                    messageInputDom.val('');
                }
            });
        });
    </script>
</head>
<body>
    <div id="chat-log" style="height: 500px">
        {% for message in messages %}
            <div><strong>{{ message.sender }}</strong>: {{ message.content }}</div>
        {% endfor %}
    </div>
    <input id="chat-message-input" type="text" autofocus>
</body>
</html>
