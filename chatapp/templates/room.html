<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        var room_id = '{{ room_id }}';
        var chatSocket = new WebSocket((window.location.protocol === 'https:' ? 'wss://' : 'ws://') + window.location.host + '/ws/chat/' + room_id + '/');

        chatSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            var sender = data['sender'];

            // Display the message
            $('#chat-log').append('<div><strong>' + sender + '</strong>: ' + message + '</div>');
        };

        $(document).ready(function() {
            $('#chat-message-input').on('keypress', function(event) {
                if (event.keyCode === 13) {  // Enter key
                    event.preventDefault();
                    var messageInputDom = $('#chat-message-input');
                    var message = messageInputDom.val();

                    // Send the message
                    chatSocket.send(JSON.stringify({
                        'room_id': room_id,
                        'message': message
                    }));

                    messageInputDom.val('');
                }
            });
        });
    </script>
</head>
<body>
    <div id="chat-log" style="height: 500px">
        {% for message in messages %}
            <div><strong>{{ message.sender }}</strong>: {{ message.content }}</div>
        {% endfor %}
    </div>
    <input id="chat-message-input" type="text" autofocus>
</body>
</html>
